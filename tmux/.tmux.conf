set -g default-terminal "tmux-256color"
set -as terminal-features ",*:RGB"

# Change default prefix from ctrl+B to ctrl+space
unbind C-Space # not sure if this does anything by default, but still.
set -g prefix C-Space # use ctrl+space as prefix now
bind C-Space send-prefix # useful when there are multiple sessions

# Default is 500ms, a bit much says the internet.
set -sg escape-time 10

# Enable mouse interaction
setw -g mouse on

# Increase history limit, default is a MEASLY 2k.
set-option -g history-limit 10000

# Array indexes start at 1 here and ONLY here.
set -g base-index 1 # for windows
setw -g pane-base-index 1 # for panes

# vi copy mode
set-window-option -g mode-keys vi

# double click to select word, triple to select line
bind-key -T copy-mode-vi DoubleClick1Pane \
    select-pane \; \
    send-keys -X select-word-no-clear \; \
    send-keys -X copy-pipe-no-clear "xclip -in -sel primary"
bind-key -n DoubleClick1Pane \
    select-pane \; \
    copy-mode -M \; \
    send-keys -X select-word \; \
    send-keys -X copy-pipe-no-clear "xclip -in -sel primary"

# Triple LMB Select & Copy (Line)
bind-key -T copy-mode-vi TripleClick1Pane \
    select-pane \; \
    send-keys -X select-line \; \
    send-keys -X copy-pipe-no-clear "xclip -in -sel primary"
bind-key -n TripleClick1Pane \
    select-pane \; \
    copy-mode -M \; \
    send-keys -X select-line \; \
    send-keys -X copy-pipe-no-clear "xclip -in -sel primary"

# copy selection to system clipboard
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'

# statusbar formatting
set -g window-status-format "#W "
set -g window-status-current-format "#[reverse,bold] #(printf '%%s\n' '#W' | tr '[:lower:]' '[:upper:]') "
set -g status-position bottom
set -g status-justify centre
set -g status-left '[#H]'
set -g status-style 'fg=#282828,bg=#98971a'
set -g status-right ' %a %b %d %H:%M '
set -g status-right-length 50

# nice thick borders between panes
set -g pane-border-lines heavy

# Use border status to display current running command.
set -g pane-border-status top
# Only show border status when there are multiple panes:
set-hook -g window-layout-changed 'set-window -F pane-border-status "#{?#{==:#{window_panes},1},off,top}"'
set -g pane-border-format " #P: #{pane_current_command} "

# Update status line more often than every 15s.
set -g status-interval 1

# Kill window, pane without confirmation
bind-key & kill-window
bind-key x kill-pane

# edit pane content in helix in popup. wowza.
bind-key e display-popup -w 95% -h 90% -E "tmux capture-pane -Jp -S- | hx -"
# open popup lazygit for current dir
bind-key g popup -E -w 95% -h 95%  -d '#{pane_current_path}' lazygit

# These shortcuts only apply to panes running helix.
# Prefix>Alt+S == Save File => esc, esc, :w, enter.
bind-key M-s if-shell 'echo "#{pane_current_command}" | grep -qE "(n)?hx"' 'send-keys Escape; send-keys Escape; send-keys -l ":w"; send-keys Enter'
# Prefix>Alt+C == Copy to system clipboard => space, y
bind-key M-c if-shell 'echo "#{pane_current_command}" | grep -qE "(n)?hx"' 'send-keys Space; send-keys -l "y"'

# PASTE ACTUALLY WORKS WITHOUT THIS, THANK GOD.
# Prefix>Alt+P == Paste from system clipboard => space, p
# bind-key M-v if-shell 'echo "#{pane_current_command}" | grep -qE "(n)?hx"' 'send-keys Space; send-keys -l "p"'
# PASTE ACTUALLY WORKS WITHOUT THIS, THANK GOD.

# Prefix>Alt+B == Go to definition => esc, esc, g, d
bind-key M-b if-shell 'echo "#{pane_current_command}" | grep -qE "(n)?hx"' 'send-keys Escape; send-keys Escape; send-keys -l "gd"'
# TODO continue with this pattern

# Prefix>Alt+R == Go to references => g, r
bind-key M-r if-shell 'echo "#{pane_current_command}" | grep -qE "(n)?hx"' 'send-keys Escape; send-keys Escape; send-keys -l "gr"'

# Prefix>Alt+F == Search => /
bind-key M-f if-shell 'echo "#{pane_current_command}" | grep -qE "(n)?hx"' 'send-keys Escape; send-keys Escape; send-keys -l "/"'

# Prefix>Alt+Shift+F == Global Search => space, /
bind-key M-F if-shell 'echo "#{pane_current_command}" | grep -qE "(n)?hx"' 'send-keys Escape; send-keys Escape; send-keys Space; send-keys -l "/"'

# Prefix>Alt+e == Buffer picker => space, b
bind-key M-e if-shell 'echo "#{pane_current_command}" | grep -qE "(n)?hx"' 'send-keys Escape; send-keys Escape; send-keys Space; send-keys -l "b"'

# Prefix>Alt+Z == Undo => u
bind-key M-z if-shell 'echo "#{pane_current_command}" | grep -qE "(n)?hx"' 'send-keys Escape; send-keys Escape; send-keys -l "u"'

# Prefix>Alt+Shift+Z == Redo => U
bind-key M-Z if-shell 'echo "#{pane_current_command}" | grep -qE "(n)?hx"' 'send-keys Escape; send-keys Escape; send-keys -l "U"'
